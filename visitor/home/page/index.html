<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home app.jloads.com</title>

        <script src="//load.jloads.com/load.js"></script>
<!--    <script src="//localhost:8080/load.js?1"></script>-->

    <script>
        // time();
        // REDIRECTION from http -> https
        var dev = window.location.hostname === 'localhost';
        var https = window.location.protocol === 'https:';
        console.log(dev, https, window.location.protocol, window.location);
        if (!dev && !https) {
            window.location.href = window.location.href.replace('http', 'https');
        }
    </script>

</head>
<body>

<div class="home-messages">
    ..
</div>


<div id="home-plugins">
    ...

</div>

<div id="home-images">
    ...

</div>


<script>

    // TODO: move all scripts to js.jloads.com

    var success = function (data) {
        console.log('loaded', data);
    };
    var error = function (data) {
        console.error('!loaded', data);
    };

    var jloads = new Load(document.body, success, error);

    jloads.env("//localhost:80/", "local", function () {
        return window.location.hostname === 'localhost';
    })

    jloads.env("//js.jloads.com/", "production", function () {
        return window.location.hostname !== 'localhost';
    })

    // console.log(
    //     'loada',loada
    // );

    // jloads.cache(1).cascade().js([
    jloads.cacheOff().js([
        "load/message.js",
        "load/e.js",
        "load/formToObject.min.js",
        "load/response.js",
        "rest/rest.js",

        "include/include.js",

        "load/listener.js",
        "load/router.js",
        "rest/rest-form.js"
    ]);


    var app = new Load(document.body, success, error);
    app.env("//localhost:3000/", "local", function () {
        return window.location.hostname === 'localhost';
    })
    app.env("//app.jloads.com/", "production", function () {
        return window.location.hostname !== 'localhost';
    })
    app.cacheOff();

    app.js([
            "visitor/home/js/form.js"
        ]);

    app.style([
        "visitor/newsletter/css/black.css",
        "visitor/home/css/mobile.css"
    ]);

    var media = new Load(document.body, success, error);
    media.env("//localhost:3000/", "local", function () {
        return window.location.hostname === 'localhost';
    })
    media.env("//app.jloads.com/", "production", function () {
        return window.location.hostname !== 'localhost';
    })
    media.delay(10).target("#home-plugins");
    media.html([
        "visitor/home/plugin/messages.html",
        "visitor/newsletter/plugin/create.html"
    ]);


    var images = new Load(document.body, success, error);


    images.target("#home-images").img([
        "//app.jloads.com/visitor/home/img/apiunit.png"
    ]);


    // console.log(
    //     load(target, success, error)
    // );
    //
    // jloads.delay(100).cache(1).js([
    //     "//js.jloads.com/index.js",
    //     "//js.jloads.com/index1.js"
    // ]);

    //
    // load(target, success, error).style([
    //     "/visitor/newsletter/css/black.css",
    //     "/visitor/home/css/mobile.css"
    // ]);
    //
    //
    // var target = document.body;
    //
    // load(target, success, error).html([
    //     "/visitor/home/plugin/messages.html",
    //     "/visitor/newsletter/plugin/create.html"
    // ]);
    //
    //
    // load(target, success, error).image([
    //     "/visitor/home/img/jloads.png"
    // ]);


    // event('submit');

    // TODO: more possbilites, recognise extension
    // function myPlugin() {
    //
    //     var opts = {
    //         verbose: false
    //     };                          ///< The options required to run this function
    //     var self = this;            ///< An alias to 'this' in case we're in jQuery                         ///< Constants required for this function to work
    //
    //     this.getOptions = function() {
    //         return opts;
    //     };
    //
    //     this.setOptions = function(options) {
    //         for (var x in options) {
    //             opts[x] = options[x];
    //         }
    //     };
    //
    //     /**
    //      * @brief Load the required files for this plugin
    //      * @param {Function} callback A callback function to run when all files have been loaded
    //      */
    //     this.loadRequiredFiles = function (callback) {
    //         var scripts = ['xx.js', 'yy.js'];
    //         var styles = ['zz.css'];
    //         var filesloaded = 0;
    //         var filestoload = scripts.length + styles.length;
    //         for (var i = 0; i < scripts.length; i++) {
    //             log('Loading script ' + scripts[i]);
    //             var script = document.createElement('script');
    //             script.type = 'text/javascript';
    //             script.src = scripts[i];
    //             script.onload = function () {
    //                 log('Loaded script');
    //                 log(this);
    //                 filesloaded++;
    //                 finishLoad();
    //             };
    //             document.head.appendChild(script);
    //         }
    //         for (var i = 0; i < styles.length; i++) {
    //             log('Loading style ' + styles[i]);
    //             var style = document.createElement('link');
    //             style.rel = 'stylesheet';
    //             style.href = styles[i];
    //             style.type = 'text/css';
    //             style.onload = function () {
    //                 log('Loaded style');
    //                 log(this);
    //                 filesloaded++;
    //                 finishLoad();
    //             };
    //             document.head.appendChild(style);
    //         }
    //         function finishLoad() {
    //             if (filesloaded === filestoload) {
    //                 callback();
    //             }
    //         }
    //     };
    //
    //     /**
    //      * @brief Enable user-controlled logging within this function
    //      * @param {String} msg The message to log
    //      * @param {Boolean} force True to log message even if user has set logging to false
    //      */
    //     function log(msg, force) {
    //         if (opts.verbose || force) {
    //             console.log(msg);
    //         }
    //     }
    //
    //     /**
    //      * @brief Initialise this function
    //      */
    //     this.init = function() {
    //         self.loadRequiredFiles(self.afterLoadRequiredFiles);
    //     };
    //
    //     this.afterLoadRequiredFiles = function () {
    //         // Do stuff
    //     };
    //
    // }

</script>

</body>
</html>
